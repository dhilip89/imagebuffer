!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.kami=a():"undefined"!=typeof global?global.kami=a():"undefined"!=typeof self&&(self.kami=a())}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};a[g][0].call(j.exports,function(b){var c=a[g][1][b];return e(c?c:b)},j,j.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c=a("klasse"),d=a("signals"),e=new c({remaining:{get:function(){return this.__totalItems-this.__loadCount}},total:{get:function(){return this.__totalItems}},initialize:function(a){if(!a)throw"no context defined for AssetManager";this.assets=[],this.tasks=[],this.__loadCount=0,this.__totalItems=0,this.__invalidateFunc=null,this.loadStarted=new d,this.loadFinished=new d,this.loadProgress=new d,this.loadError=new d,this.loaders={},this.__invalidateFunc=this.invalidate.bind(this),this.context=a,this.context.lost.add(this.__invalidateFunc)},destroy:function(){this.assets=[],this.tasks=[],this.__loadCount=this.__totalItems=0,this.context&&this.context.lost.remove(this.__invalidateFunc)},invalidate:function(){for(var a=0;a<this.assets.length;a++)this.assets[a].status=e.Status.QUEUED;this.tasks=this.assets.slice(),this.__loadCount=this.__totalItems=this.tasks.length},__getDataType:function(a){var b="data:",c=a.slice(0,b.length).toLowerCase();if(c==b){var d=a.slice(b.length),e=d.indexOf(",");if(-1===e)return null;var f=d.slice(0,e).split(";")[0];return f&&"text/plain"!=f.toLowerCase()?f.split("/").pop().toLowerCase():"txt"}return null},__extension:function(a){var b=a.lastIndexOf(".");return-1===b||0===b||b===a.length-1?"":a.substring(b+1).toLowerCase()},load:function(a){if(!a)throw"No asset name specified for load()";var b=this.__getDataType(a);if(null===b&&(b=this.__extension(a)),!b)throw"Asset name does not have a file extension: "+a;if(!e.loaders.hasOwnProperty(b))throw"No known loader for extension "+b+" in asset "+a;var c=[e.loaders[b],a];return c=c.concat(Array.prototype.slice.call(arguments,1)),this.loadAs.apply(this,c)},loadAs:function(a,b){if(!b)throw"no name specified to load";if(!a)throw"no loader specified for asset "+b;var c=this.__indexOf(this.assets,b);if(-1!==c)throw"asset already defined in asset manager";var d=Array.prototype.slice.call(arguments,1),f=new(Function.prototype.bind.apply(a,[null,this.context].concat(d))),g=new e.Descriptor(b,f);return this.assets.push(g),this.tasks.push(g),this.__loadCount++,this.__totalItems++,"function"==typeof f.getReturnValue?f.getReturnValue():void 0},__indexOf:function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return c;return-1},__loadCallback:function(a,b){b=b!==!1,this.__loadCount--;var c=this.__indexOf(this.assets,a);-1!==c&&(this.assets[c].status=b?e.Status.LOAD_SUCCESS:e.Status.LOAD_FAILED,b||this.loadError.dispatch(a)),this.loadProgress.dispatch(this.__totalItems-this.__loadCount,this.__totalItems,a),0===this.__loadCount&&this.loadFinished.dispatch()},update:function(){if(!this.context.valid)return!1;if(0===this.tasks.length)return 0===this.__loadCount;this.tasks.length===this.assets.length&&this.loadStarted.dispatch();var a=this.tasks.shift(),b=a.loader,c=this.__loadCallback.bind(this,a.name);return b.load.call(b,c),0===this.__loadCount}});e.loaders={},e.registerLoader=function(a,b,c){if(0===arguments.length)throw"must specify at least one extension for the loader";for(var d=0;d<b.length;d++)e.loaders[b[d]]=a,c&&(e.loaders[c+"/"+b[d]]=a)},e.Descriptor=function(a,b){this.name=a,this.loader=b,this.status=e.Status.QUEUED},e.Status={QUEUED:0,LOADING:1,LOAD_SUCCESS:2,LOAD_FAIL:3},b.exports=e},{klasse:12,signals:14}],2:[function(a,b){var c=a("klasse"),d=a("./glutils/Mesh"),e=a("number-util").colorToFloat,f=new c({initialize:function(a,b){if(!a)throw"GL context not specified";if(this.context=a,this.size=b||500,this.size>10922)throw"Can't have more than 10922 sprites per batch: "+this.size;this.shader=this._createShader(),this._blendSrc=this.context.gl.ONE,this._blendDst=this.context.gl.ONE_MINUS_SRC_ALPHA,this._blendEnabled=!0,this.idx=0,this.drawing=!1,this.mesh=this._createMesh(this.size),this.color=e(255,255,255,255),this.premultiplied=!0},setColor:function(a,b,c,d){arguments.length>=3?d=d||0===d?d:1:a=b=c=d=arguments[0]||0,this.premultiplied&&(a*=d,b*=d,c*=d),this.color=e(~~(255*a),~~(255*b),~~(255*c),~~(255*d))},_createMesh:function(a){var b=4*a*this.getVertexSize(),c=6*a,e=this.context.gl;this.vertices=new Float32Array(b),this.indices=new Uint16Array(c);for(var f=0,g=0;c>f;f+=6,g+=4)this.indices[f+0]=g+0,this.indices[f+1]=g+1,this.indices[f+2]=g+2,this.indices[f+3]=g+0,this.indices[f+4]=g+2,this.indices[f+5]=g+3;var h=new d(this.context,!1,b,c,this._createVertexAttributes());return h.vertices=this.vertices,h.indices=this.indices,h.vertexUsage=e.DYNAMIC_DRAW,h.indexUsage=e.STATIC_DRAW,h.dirty=!0,h},_createShader:function(){throw"_createShader not implemented"},_createVertexAttributes:function(){throw"_createVertexAttributes not implemented"},getVertexSize:function(){throw"getVertexSize not implemented"},begin:function(){if(this.drawing)throw"batch.end() must be called before begin";this.drawing=!0,this.shader.bind(),this.mesh.bind(this.shader)},end:function(){if(!this.drawing)throw"batch.begin() must be called before end";this.idx>0&&this.flush(),this.drawing=!1,this.mesh.unbind(this.shader)},_preRender:function(){},_postRender:function(){},flush:function(){if(0!==this.idx){var a=this.gl;this._preRender();var b=this.getVertexSize(),c=this.idx/(4*b),a=this.context.gl;this.mesh.verticesDirty=!0,this.mesh.draw(a.TRIANGLES,6*c,0,this.idx),this.idx=0}},draw:function(){},drawVertices:function(){},drawRegion:function(a,b,c,d,e){this.draw(a.texture,b,c,d,e,a.u,a.v,a.u2,a.v2)},destroy:function(){this.vertices=[],this.indices=[],this.size=this.maxVertices=0,this.mesh.destroy()}});b.exports=f},{"./glutils/Mesh":8,klasse:12,"number-util":13}],3:[function(a,b){var c=a("klasse"),d=a("./BaseBatch"),e=a("./glutils/Mesh"),f=a("./glutils/ShaderProgram"),g=new c({Mixins:d,initialize:function(a,b){d.call(this,a,b),this.projection=new Float32Array(2),this.projection[0]=this.context.width,this.projection[1]=this.context.height,this.texture=null},getVertexSize:function(){return g.VERTEX_SIZE},_createVertexAttributes:function(){var a=this.context.gl;return[new e.Attrib("Position",2),new e.Attrib("Color",4,null,a.UNSIGNED_BYTE,!0,1),new e.Attrib("TexCoord0",2)]},setProjection:function(a,b){var c=this.projection[0],d=this.projection[1];this.projection[0]=a,this.projection[1]=b,!this.drawing||a==c&&b==d||(this.flush(),this._updateMatrices())},_createShader:function(){var a=new f(this.context,g.DEFAULT_VERT_SHADER,g.DEFAULT_FRAG_SHADER);return a.log&&console.warn("Shader Log:\n"+a.log),a},updateMatrices:function(){this.shader.setUniformfv("u_projection",this.projection)},_preRender:function(){this.texture&&this.texture.bind()},begin:function(){var a=this.context.gl;d.prototype.begin.call(this),this.updateMatrices(),this.shader.setUniformi("u_texture0",0),a.depthMask(!1),this._blendEnabled&&(a.enable(a.BLEND),-1!==this._blendSrc&&-1!==this._blendDst&&a.blendFunc(this._blendSrc,this._blendDst))},end:function(){var a=this.context.gl;d.prototype.end.call(this),a.depthMask(!0),this._blendEnabled&&a.disable(a.BLEND)},flush:function(){this.texture&&0!==this.idx&&(d.prototype.flush.call(this),g.totalRenderCalls++)},draw:function(a,b,c,d,e,f,g,h,i){if(!this.drawing)throw"Illegal State: trying to draw a batch before begin()";if(a){null===this.texture||this.texture.id!==a.id?(this.flush(),this.texture=a):this.idx==this.vertices.length&&this.flush(),d=0===d?d:d||a.width,e=0===e?e:e||a.height,b=b||0,c=c||0;var j=b,k=b+d,l=c,m=c+e;f=f||0,h=0===h?h:h||1,g=g||0,i=0===i?i:i||1;var n=this.color;this.vertices[this.idx++]=j,this.vertices[this.idx++]=l,this.vertices[this.idx++]=n,this.vertices[this.idx++]=f,this.vertices[this.idx++]=g,this.vertices[this.idx++]=k,this.vertices[this.idx++]=l,this.vertices[this.idx++]=n,this.vertices[this.idx++]=h,this.vertices[this.idx++]=g,this.vertices[this.idx++]=k,this.vertices[this.idx++]=m,this.vertices[this.idx++]=n,this.vertices[this.idx++]=h,this.vertices[this.idx++]=i,this.vertices[this.idx++]=j,this.vertices[this.idx++]=m,this.vertices[this.idx++]=n,this.vertices[this.idx++]=f,this.vertices[this.idx++]=i}},drawVertices:function(a,b,c){if(!this.drawing)throw"Illegal State: trying to draw a batch before begin()";a&&(this.texture!=a?(this.flush(),this.texture=a):this.idx==this.vertices.length&&this.flush(),c=c||0,this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++],this.vertices[this.idx++]=b[c++])}});g.VERTEX_SIZE=5,g.totalRenderCalls=0,g.DEFAULT_FRAG_SHADER=["precision mediump float;","varying vec2 vTexCoord0;","varying vec4 vColor;","uniform sampler2D u_texture0;","void main(void) {","   gl_FragColor = texture2D(u_texture0, vTexCoord0) * vColor;","}"].join("\n"),g.DEFAULT_VERT_SHADER=["attribute vec2 Position;","attribute vec4 Color;","attribute vec2 TexCoord0;","uniform vec2 u_projection;","varying vec2 vTexCoord0;","varying vec4 vColor;","void main(void) {","   gl_Position = vec4( Position.x / u_projection.x - 1.0, Position.y / -u_projection.y + 1.0 , 0.0, 1.0);","   vTexCoord0 = TexCoord0;","   vColor = Color;","}"].join("\n"),b.exports=g},{"./BaseBatch":2,"./glutils/Mesh":8,"./glutils/ShaderProgram":9,klasse:12}],4:[function(a,b){var c=a("klasse"),d=(a("signals"),a("number-util").nextPowerOfTwo,a("number-util").isPowerOfTwo),e=new c({initialize:function f(a){if(!a)throw"GL context not specified";this.context=a,this.id=null,this.target=null,this.width=0,this.height=0,this.wrapS=f.DEFAULT_WRAP,this.wrapT=f.DEFAULT_WRAP,this.minFilter=f.DEFAULT_FILTER,this.magFilter=f.DEFAULT_FILTER,this.managedArgs=Array.prototype.slice.call(arguments,1),this.context.addManagedObject(this),this.create()},create:function(){this.gl=this.context.gl;var a=this.gl;this.id=a.createTexture(),this.width=this.height=0,this.target=a.TEXTURE_2D,this.bind(),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.UNPACK_PREMULTIPLY_ALPHA),a.pixelStorei(a.UNPACK_ALIGNMENT,e.UNPACK_ALIGNMENT),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,e.UNPACK_FLIP_Y);var b=e.UNPACK_COLORSPACE_CONVERSION||a.BROWSER_DEFAULT_WEBGL;a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,b),this.setWrap(this.wrapS,this.wrapT,!1),this.setFilter(this.minFilter,this.magFilter,!1),0!==this.managedArgs.length&&this.uploadData.apply(this,this.managedArgs)},destroy:function(){this.id&&this.gl&&this.gl.deleteTexture(this.id),this.context&&this.context.removeManagedObject(this),this.width=this.height=0,this.id=null,this.managedArgs=null,this.context=null,this.gl=null},setWrap:function(a,b,c){a&&b?(this.wrapS=a,this.wrapT=b):this.wrapS=this.wrapT=a,this._checkPOT(),c||this.bind();var d=this.gl;d.texParameteri(this.target,d.TEXTURE_WRAP_S,this.wrapS),d.texParameteri(this.target,d.TEXTURE_WRAP_T,this.wrapT)},setFilter:function(a,b,c){a&&b?(this.minFilter=a,this.magFilter=b):this.minFilter=this.magFilter=a,this._checkPOT(),c||this.bind();var d=this.gl;d.texParameteri(this.target,d.TEXTURE_MIN_FILTER,this.minFilter),d.texParameteri(this.target,d.TEXTURE_MAG_FILTER,this.magFilter)},uploadData:function(a,b,c,d,e){var f=this.gl;this.format=c||f.RGBA,d=d||f.UNSIGNED_BYTE,e=e||null,this.width=a||0==a?a:this.width,this.height=b||0==b?b:this.height,this._checkPOT(),this.bind(),f.texImage2D(this.target,0,this.format,this.width,this.height,0,this.format,d,e)},uploadImage:function(a,b,c){var d=this.gl;this.format=b||d.RGBA,c=c||d.UNSIGNED_BYTE,this.width=a.width,this.height=a.height,this._checkPOT(),this.bind(),d.texImage2D(this.target,0,this.format,this.format,c,a)},_checkPOT:function(){if(!e.FORCE_POT){var a=this.minFilter!==e.Filter.LINEAR&&this.minFilter!==e.Filter.NEAREST,b=this.wrapS!==e.Wrap.CLAMP_TO_EDGE||this.wrapT!==e.Wrap.CLAMP_TO_EDGE;if(!(!a&&!b||d(this.width)&&d(this.height)))throw new Error(a?"Non-power-of-two textures cannot use mipmapping as filter":"Non-power-of-two textures must use CLAMP_TO_EDGE as wrap")}},bind:function(a){var b=this.gl;(a||0===a)&&b.activeTexture(b.TEXTURE0+a),b.bindTexture(this.target,this.id)},toString:function(){return this.id+":"+this.width+"x"+this.height}});e.Filter={NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985},e.Wrap={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},e.Format={DEPTH_COMPONENT:6402,ALPHA:6406,RGBA:6408,RGB:6407,LUMINANCE:6409,LUMINANCE_ALPHA:6410},e.DataType={BYTE:5120,SHORT:5122,INT:5124,FLOAT:5126,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635},e.DEFAULT_WRAP=e.Wrap.CLAMP_TO_EDGE,e.DEFAULT_FILTER=e.Filter.NEAREST,e.FORCE_POT=!1,e.UNPACK_FLIP_Y=!1,e.UNPACK_ALIGNMENT=1,e.UNPACK_PREMULTIPLY_ALPHA=!0,e.UNPACK_COLORSPACE_CONVERSION=void 0,e.getNumComponents=function(a){switch(a){case e.Format.DEPTH_COMPONENT:case e.Format.ALPHA:case e.Format.LUMINANCE:return 1;case e.Format.LUMINANCE_ALPHA:return 2;case e.Format.RGB:return 3;case e.Format.RGBA:return 4}return null},b.exports=e},{klasse:12,"number-util":13,signals:14}],5:[function(a,b){var c=a("klasse"),d=(a("./Texture"),new c({initialize:function(a,b,c,d,e){this.texture=a,this.setRegion(b,c,d,e)},setUVs:function(a,b,c,d){if(this.regionWidth=Math.round(Math.abs(c-a)*this.texture.width),this.regionHeight=Math.round(Math.abs(d-b)*this.texture.height),1==this.regionWidth&&1==this.regionHeight){var e=.25/texWidth;a+=e,c-=e;var f=.25/texHeight;b+=f,d-=f}this.u=a,this.v=b,this.u2=c,this.v2=d},setRegion:function(a,b,c,d){a=a||0,b=b||0,c=0===c||c?c:this.texture.width,d=0===d||d?d:this.texture.height;var e=1/this.texture.width,f=1/this.texture.height;this.setUVs(a*e,b*f,(a+c)*e,(b+d)*f),this.regionWidth=Math.abs(c),this.regionHeight=Math.abs(d)},setFromRegion:function(a,b,c,d,e){this.texture=a.texture,this.set(a.getRegionX()+b,a.getRegionY()+c,d,e)},regionX:{get:function(){return Math.round(this.u*this.texture.width)}},regionY:{get:function(){return Math.round(this.v*this.texture.height)}},flip:function(a,b){var c;a&&(c=this.u,this.u=this.u2,this.u2=c),b&&(c=this.v,this.v=this.v2,this.v2=c)}}));b.exports=d},{"./Texture":4,klasse:12}],6:[function(a,b){var c=a("klasse"),d=a("signals"),e=new c({initialize:function(a,b,c,e){this.managedObjects=[],this.gl=null,this.view=c||document.createElement("canvas"),this.width=this.view.width=a||300,this.height=this.view.height=b||150,this.contextAttributes=e,this.valid=!1,this.lost=new d,this.restored=new d,this.view.addEventListener("webglcontextlost",function(a){a.preventDefault(),this._contextLost(a)}.bind(this)),this.view.addEventListener("webglcontextrestored",function(a){a.preventDefault(),this._contextRestored(a)}.bind(this)),this._initContext(),this.resize(this.width,this.height)},_initContext:function(){this.valid=!1;try{this.gl=this.view.getContext("webgl",this.contextAttributes)||this.view.getContext("experimental-webgl",this.contextAttributes)}catch(a){this.gl=null}if(!this.gl)throw"WebGL Context Not Supported -- try enabling it or using a different browser";this.valid=!0},resize:function(a,b){this.width=a,this.height=b,this.view.width=a,this.view.height=b;var c=this.gl;c.viewport(0,0,this.width,this.height)},addManagedObject:function(a){this.managedObjects.push(a)},removeManagedObject:function(a){var b=this.managedObjects.indexOf(a);return b>-1?(this.managedObjects.splice(b,1),a):null},destroy:function(){for(var a=0;a<this.managedObjects.length;a++){var b=this.managedObjects[a];b&&b.destroy()}this.managedObjects.length=0,this.valid=!1,this.gl=null,this.view=null,this.width=this.height=0},_contextLost:function(){this.valid=!1,this.lost.dispatch(this)},_contextRestored:function(){this._initContext();for(var a=0;a<this.managedObjects.length;a++)this.managedObjects[a].create();this.resize(this.width,this.height),this.restored.dispatch(this)}});b.exports=e},{klasse:12,signals:14}],7:[function(a,b){var c=a("klasse"),d=a("../Texture"),e=new c({initialize:function(a,b,c,e){this.id=null,this.context=a,this.texture=new d(a,b,c,e),this.context.addManagedObject(this),this.create()},width:{get:function(){return this.texture.width}},height:{get:function(){return this.texture.height}},create:function(){this.gl=this.context.gl;var a=this.gl,b=this.texture;b.bind(),this.id=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,this.id),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,b.target,b.id,0);var c=a.checkFramebufferStatus(a.FRAMEBUFFER);if(c!=a.FRAMEBUFFER_COMPLETE){this.destroy();var d="Framebuffer not complete";switch(c){case a.FRAMEBUFFER_UNSUPPORTED:throw new Error(d+": unsupported");case a.INCOMPLETE_DIMENSIONS:throw new Error(d+": incomplete dimensions");case a.INCOMPLETE_ATTACHMENT:throw new Error(d+": incomplete attachment");case a.INCOMPLETE_MISSING_ATTACHMENT:throw new Error(d+": missing attachment");default:throw new Error(d)}}a.bindFramebuffer(a.FRAMEBUFFER,null)},destroy:function(){this.gl;this.texture&&this.texture.destroy(),this.id&&this.gl&&this.gl.deleteFramebuffer(this.id),this.context&&this.context.removeManagedObject(this),this.id=null,this.texture=null},begin:function(){var a=this.gl;a.viewport(0,0,this.texture.width,this.texture.height),a.bindFramebuffer(a.FRAMEBUFFER,this.id)},end:function(){var a=this.gl;a.viewport(0,0,this.context.width,this.context.height),a.bindFramebuffer(a.FRAMEBUFFER,null)}});b.exports=e},{"../Texture":4,klasse:12}],8:[function(a,b){var c=a("klasse"),d=new c({dirty:{set:function(a){this.verticesDirty=a,this.indicesDirty=a}},initialize:function(a,b,c,d,e){if(!a)throw"GL context not specified";if(!c)throw"numVerts not specified, must be > 0";this.context=a,this.gl=a.gl,this.numVerts=null,this.numIndices=null,this.vertices=null,this.indices=null,this.vertexBuffer=null,this.indexBuffer=null,this.verticesDirty=!0,this.indicesDirty=!0,this.indexUsage=null,this.vertexUsage=null,this._vertexAttribs=null,this._vertexStride=null,this.numVerts=c,this.numIndices=d||0,this.vertexUsage=b?this.gl.STATIC_DRAW:this.gl.DYNAMIC_DRAW,this.indexUsage=b?this.gl.STATIC_DRAW:this.gl.DYNAMIC_DRAW,this._vertexAttribs=e||[],this.indicesDirty=!0,this.verticesDirty=!0;for(var f=0,g=0;g<this._vertexAttribs.length;g++)f+=this._vertexAttribs[g].offsetCount;this._vertexStride=4*f,this.vertices=new Float32Array(this.numVerts),this.indices=new Uint16Array(this.numIndices),this.context.addManagedObject(this),this.create()},create:function(){this.gl=this.context.gl;var a=this.gl;this.vertexBuffer=a.createBuffer(),this.indexBuffer=this.numIndices>0?a.createBuffer():null,this.dirty=!0},destroy:function(){this.vertices=[],this.indices=[],this.vertexBuffer&&this.gl&&this.gl.deleteBuffer(this.vertexBuffer),this.indexBuffer&&this.gl&&this.gl.deleteBuffer(this.indexBuffer),this.vertexBuffer=null,this.indexBuffer=null,this.context&&this.context.removeManagedObject(this),this.gl=null,this.context=null},_updateBuffers:function(a,b){var c=this.gl;if(this.numIndices>0&&(a||c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.indicesDirty&&(c.bufferData(c.ELEMENT_ARRAY_BUFFER,this.indices,this.indexUsage),this.indicesDirty=!1)),a||c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer),this.verticesDirty){if(b){var d=this.vertices.subarray(0,b);c.bufferSubData(c.ARRAY_BUFFER,0,d)}else c.bufferData(c.ARRAY_BUFFER,this.vertices,this.vertexUsage);this.verticesDirty=!1}},draw:function(a,b,c,d){if(0!==b){var e=this.gl;c=c||0,this._updateBuffers(!0,d),this.numIndices>0?e.drawElements(a,b,e.UNSIGNED_SHORT,2*c):e.drawArrays(a,c,b)}},bind:function(a){var b=this.gl,c=0,d=this._vertexStride;this._updateBuffers();for(var e=0;e<this._vertexAttribs.length;e++){var f=this._vertexAttribs[e],g=null===f.location?a.getAttributeLocation(f.name):f.location;b.enableVertexAttribArray(g),b.vertexAttribPointer(g,f.numComponents,f.type||b.FLOAT,f.normalize,d,c),c+=4*f.offsetCount}},unbind:function(a){for(var b=this.gl,c=0;c<this._vertexAttribs.length;c++){var d=this._vertexAttribs[c],e=null===d.location?a.getAttributeLocation(d.name):d.location;b.disableVertexAttribArray(e)}}});d.Attrib=new c({name:null,numComponents:null,location:null,type:null,initialize:function(a,b,c,d,e,f){this.name=a,this.numComponents=b,this.location="number"==typeof c?c:null,this.type=d,this.normalize=Boolean(e),this.offsetCount="number"==typeof f?f:this.numComponents}}),b.exports=d},{klasse:12}],9:[function(a,b){var c=a("klasse"),d=new c({initialize:function(a,b,c,d){if(!b||!c)throw"vertex and fragment shaders must be defined";if(!a)throw"no GL context specified";this.context=a,this.vertShader=null,this.fragShader=null,this.program=null,this.log="",this.uniformCache=null,this.attributeCache=null,this.attributeLocations=d,this.vertSource=b.trim(),this.fragSource=c.trim(),this.context.addManagedObject(this),this.create()},create:function(){this.gl=this.context.gl,this._compileShaders()},_compileShaders:function(){var a=this.gl;if(this.log="",this.vertShader=this._loadShader(a.VERTEX_SHADER,this.vertSource),this.fragShader=this._loadShader(a.FRAGMENT_SHADER,this.fragSource),!this.vertShader||!this.fragShader)throw"Error returned when calling createShader";if(this.program=a.createProgram(),a.attachShader(this.program,this.vertShader),a.attachShader(this.program,this.fragShader),this.attributeLocations)for(var b in this.attributeLocations)this.attributeLocations.hasOwnProperty(b)&&a.bindAttribLocation(this.program,Math.floor(this.attributeLocations[b]),b);if(a.linkProgram(this.program),this.log+=a.getProgramInfoLog(this.program)||"",!a.getProgramParameter(this.program,a.LINK_STATUS))throw"Error linking the shader program:\n"+this.log;this._fetchUniforms(),this._fetchAttributes()},_fetchUniforms:function(){var a=this.gl;this.uniformCache={};var b=a.getProgramParameter(this.program,a.ACTIVE_UNIFORMS);if(b)for(var c=0;b>c;c++){var d=a.getActiveUniform(this.program,c);if(null!==d){var e=d.name,f=a.getUniformLocation(this.program,e);this.uniformCache[e]={size:d.size,type:d.type,location:f}}}},_fetchAttributes:function(){var a=this.gl;this.attributeCache={};var b=a.getProgramParameter(this.program,a.ACTIVE_ATTRIBUTES);if(b)for(var c=0;b>c;c++){var d=a.getActiveAttrib(this.program,c);if(null!==d){var e=d.name,f=a.getAttribLocation(this.program,e);this.attributeCache[e]={size:d.size,type:d.type,location:f}}}},_loadShader:function(a,b){var c=this.gl,d=c.createShader(a);if(!d)return-1;c.shaderSource(d,b),c.compileShader(d);var e=c.getShaderInfoLog(d)||"";if(e){var f=a===c.VERTEX_SHADER?"vertex":"fragment";e="Error compiling "+f+" shader:\n"+e}if(this.log+=e,!c.getShaderParameter(d,c.COMPILE_STATUS))throw this.log;return d},bind:function(){this.gl.useProgram(this.program)},destroy:function(){if(this.context&&this.context.removeManagedObject(this),this.gl){var a=this.gl;a.detachShader(this.vertShader),a.detachShader(this.fragShader),a.deleteShader(this.vertShader),a.deleteShader(this.fragShader),a.deleteProgram(this.program)}this.attributeCache=null,this.uniformCache=null,this.vertShader=null,this.fragShader=null,this.program=null,this.gl=null,this.context=null},getUniformInfo:function(a){return this.uniformCache[a]||null},getAttributeInfo:function(a){return this.attributeCache[a]||null},getAttributeLocation:function(a){var b=this.getAttributeInfo(a);return b?b.location:null},getUniformLocation:function(a){var b=this.getUniformInfo(a);return b?b.location:null},hasUniform:function(a){return null!==this.getUniformInfo(a)},hasAttribute:function(a){return null!==this.getAttributeInfo(a)},getUniform:function(a){return this.gl.getUniform(this.program,this.getUniformLocation(a))},getUniformAt:function(a){return this.gl.getUniform(this.program,a)},setUniformi:function(a,b,c,d,e){var f=this.gl,g=this.getUniformLocation(a);if(!g)return!1;switch(arguments.length){case 2:return f.uniform1i(g,b),!0;case 3:return f.uniform2i(g,b,c),!0;case 4:return f.uniform3i(g,b,c,d),!0;case 5:return f.uniform4i(g,b,c,d,e),!0;default:throw"invalid arguments to setUniformi"}},setUniformf:function(a,b,c,d,e){var f=this.gl,g=this.getUniformLocation(a);if(!g)return!1;switch(arguments.length){case 2:return f.uniform1f(g,b),!0;case 3:return f.uniform2f(g,b,c),!0;case 4:return f.uniform3f(g,b,c,d),!0;case 5:return f.uniform4f(g,b,c,d,e),!0;default:throw"invalid arguments to setUniformf"}},setUniformfv:function(a,b){var c=this.gl,d=this.getUniformLocation(a);if(!d)return!1;switch(b.length){case 1:return c.uniform1fv(d,b),!0;case 2:return c.uniform2fv(d,b),!0;case 3:return c.uniform3fv(d,b),!0;case 4:return c.uniform4fv(d,b),!0;default:throw"invalid arguments to setUniformf"}},setUniformiv:function(a,b){var c=this.gl,d=this.getUniformLocation(a);if(!d)return!1;switch(b.length){case 1:return c.uniform1iv(d,b),!0;case 2:return c.uniform2iv(d,b),!0;case 3:return c.uniform3iv(d,b),!0;case 4:return c.uniform4iv(d,b),!0;default:throw"invalid arguments to setUniformf"}}});b.exports=d},{klasse:12}],10:[function(a,b){a("./AssetManager").registerLoader(a("./loaders/ImageLoader.js"),["png","gif","jpg","jpeg"],"image"),b.exports={AssetManager:a("./AssetManager.js"),BaseBatch:a("./BaseBatch.js"),SpriteBatch:a("./SpriteBatch.js"),Texture:a("./Texture.js"),TextureRegion:a("./TextureRegion.js"),WebGLContext:a("./WebGLContext.js"),FrameBuffer:a("./glutils/FrameBuffer.js"),Mesh:a("./glutils/Mesh.js"),ShaderProgram:a("./glutils/ShaderProgram.js"),ImageLoader:a("./loaders/ImageLoader.js"),Signal:a("signals").Signal,Class:a("klasse"),NumberUtil:a("number-util")}},{"./AssetManager":1,"./AssetManager.js":1,"./BaseBatch.js":2,"./SpriteBatch.js":3,"./Texture.js":4,"./TextureRegion.js":5,"./WebGLContext.js":6,"./glutils/FrameBuffer.js":7,"./glutils/Mesh.js":8,"./glutils/ShaderProgram.js":9,"./loaders/ImageLoader.js":11,klasse:12,"number-util":13,signals:14}],11:[function(a,b){var c=(a("../AssetManager"),a("../Texture")),d=a("klasse"),e=new d({initialize:function(a,b,d,e){this.name=b,this.path=e||this.name,this.texture=d||new c(a)},load:function(a){var b=new Image,c=this;b.onload=function(){b.onerror=b.onabort=null,c.texture.uploadImage(b),a()},b.onerror=function(){b.onload=b.onabort=null,console.warn("Error loading image: "+c.path),c.texture.uploadData(1,1),a(!1)},b.onabort=function(){b.onload=b.onerror=null,console.warn("Aborted image: "+c.path),c.texture.uploadData(1,1),a(!1)},b.src=this.path},getReturnValue:function(){return this.texture}});b.exports=e},{"../AssetManager":1,"../Texture":4,klasse:12}],12:[function(a,b){function c(a){return!!a.get&&"function"==typeof a.get||!!a.set&&"function"==typeof a.set}function d(a,b,d){var e=d?a[b]:Object.getOwnPropertyDescriptor(a,b);return!d&&e.value&&"object"==typeof e.value&&(e=e.value),e&&c(e)?("undefined"==typeof e.enumerable&&(e.enumerable=!0),"undefined"==typeof e.configurable&&(e.configurable=!0),e):!1}function e(a,b){var c=Object.getOwnPropertyDescriptor(a,b);return c?(c.value&&"object"==typeof c.value&&(c=c.value),c.configurable===!1?!0:!1):!1}function f(a,b,c,f){for(var g in b)if(b.hasOwnProperty(g)){var i=d(b,g,c);if(i!==!1){var j=f||a;if(e(j.prototype,g)){if(h.ignoreFinals)continue;throw new Error("cannot override final property '"+g+"', set Class.ignoreFinals = true to skip")}Object.defineProperty(a.prototype,g,i)}else a.prototype[g]=b[g]}}function g(a,b){if(b){Array.isArray(b)||(b=[b]);for(var c=0;c<b.length;c++)f(a,b[c].prototype||b[c])}}function h(a){a||(a={});var b,c;if(a.initialize){if("function"!=typeof a.initialize)throw new Error("initialize must be a function");b=a.initialize,delete a.initialize}else if(a.Extends){var d=a.Extends;b=function(){d.apply(this,arguments)}}else b=function(){};a.Extends?(b.prototype=Object.create(a.Extends.prototype),b.prototype.constructor=b,c=a.Extends,delete a.Extends):b.prototype.constructor=b;var e=null;return a.Mixins&&(e=a.Mixins,delete a.Mixins),g(b,e),f(b,a,!0,c),b}h.extend=f,h.mixin=g,h.ignoreFinals=!1,b.exports=h},{}],13:[function(a,b){var c=new Int8Array(4),d=new Int32Array(c.buffer,0,1),e=new Float32Array(c.buffer,0,1),f=function(){};f.intBitsToFloat=function(a){return d[0]=a,e[0]},f.floatToIntBits=function(a){return e[0]=a,d[0]},f.intToFloatColor=function(a){return f.intBitsToFloat(4278190079&a)},f.colorToFloat=function(a,b,c,d){var e=d<<24|c<<16|b<<8|a;return f.intToFloatColor(e)},f.isPowerOfTwo=function(a){return 0==(a&a-1)},f.nextPowerOfTwo=function(a){return a--,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,a|=a>>16,a+1},b.exports=f},{}],14:[function(b,c){!function(b){function d(a,b,c,d,e){this._listener=b,this._isOnce=c,this.context=d,this._signal=a,this._priority=e||0}function e(a,b){if("function"!=typeof a)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))}function f(){this._bindings=[],this._prevParams=null;var a=this;this.dispatch=function(){f.prototype.dispatch.apply(a,arguments)}}d.prototype={active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,b=this._listener.apply(this.context,c),this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},f.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(a,b,c,e){var f,g=this._indexOfListener(a,c);if(-1!==g){if(f=this._bindings[g],f.isOnce()!==b)throw new Error("You cannot add"+(b?"":"Once")+"() then add"+(b?"Once":"")+"() the same listener without removing the relationship first.")}else f=new d(this,a,b,c,e),this._addBinding(f);return this.memorize&&this._prevParams&&f.execute(this._prevParams),f},_addBinding:function(a){var b=this._bindings.length;do--b;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){return e(a,"add"),this._registerListener(a,!1,b,c)},addOnce:function(a,b,c){return e(a,"addOnce"),this._registerListener(a,!0,b,c)},remove:function(a,b){e(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(){for(var a=this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams=null
},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var g=f;g.Signal=f,"function"==typeof a&&a.amd?a(function(){return g}):"undefined"!=typeof c&&c.exports?c.exports=g:b.signals=g}(this)},{}]},{},[10])(10)});